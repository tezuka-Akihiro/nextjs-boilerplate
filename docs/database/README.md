# データベース設計

## 概要

本プロジェクトのデータベース設計に関するドキュメントを管理するディレクトリです。
Supabase（PostgreSQL）を使用したデータベース設計の詳細を記載しています。

## ディレクトリ構成

```
database/
├── README.md                    # このファイル
├── schema.md                    # データベーススキーマ定義
├── migrations/                  # マイグレーション管理
│   ├── README.md
│   └── {timestamp}_{name}.sql
├── seeds/                       # 初期データ
│   ├── README.md
│   └── {table_name}_seed.sql
└── policies/                    # RLS（行レベルセキュリティ）ポリシー
    ├── README.md
    └── {table_name}_policies.sql
```

## 設計原則

### 1. セキュリティファースト
- 全テーブルでRLS（Row Level Security）を有効化
- 最小権限の原則に基づくポリシー設計
- 機密データの暗号化

### 2. パフォーマンス最適化
- 適切なインデックス設計
- クエリパフォーマンスの監視
- 正規化とパフォーマンスのバランス

### 3. 拡張性
- 将来の機能拡張を考慮した設計
- 柔軟なデータモデル
- バージョン管理対応

## 主要テーブル

### users（ユーザー）
ユーザー基本情報を格納

### profiles（プロフィール）
ユーザーの拡張情報を格納

### audit_logs（監査ログ）
システム操作の監査ログを格納

## 関連ドキュメント

- [スキーマ定義](./schema.md) - 詳細なテーブル構造
- [マイグレーション](./migrations/README.md) - データベース変更履歴
- [初期データ](./seeds/README.md) - 開発・テスト用初期データ
- [RLSポリシー](./policies/README.md) - セキュリティポリシー

## 開発フロー

1. **設計**: スキーマ設計・レビュー
2. **マイグレーション**: SQL作成・テスト
3. **ポリシー**: RLS設定・検証
4. **シード**: 初期データ投入
5. **テスト**: 統合テスト実行

## 運用

### バックアップ
- 自動バックアップ：日次
- 手動バックアップ：重要な変更前

### 監視
- パフォーマンス監視
- 容量監視
- エラーログ監視

---

**注意**: データベース変更は必ずマイグレーションを通して行い、本番環境への適用前に十分なテストを実施してください。